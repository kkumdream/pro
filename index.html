<!doctype html>
<html lang="ko"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>노원구 꿈드림 검정고시 문제 풀이</title>
<style>
:root{--bg:#0b0b0b;--panel:#121212;--fg:#f5f5f5;--muted:#a3a3a3;--border:#2a2a2a;--good:#22c55e;--bad:#ef4444}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Apple SD Gothic Neo,Noto Sans KR,Arial}
.wrap{max-width:960px;margin:0 auto;padding:16px}
h1{margin:0 0 8px;font-size:22px}
.tabs{display:flex;gap:8px;margin:8px 0 16px}
.tabbtn{flex:1;border:1px solid var(--border);border-radius:12px;padding:12px;background:var(--panel);color:var(--fg);font-weight:700;cursor:pointer}
.tabbtn.active{outline:2px solid #333}
.card{border:1px solid var(--border);border-radius:16px;padding:16px;background:var(--panel)}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
label{display:flex;flex-direction:column;font-size:12px;color:var(--muted)}
select,.btn{border:1px solid var(--border);background:#0f0f0f;color:var(--fg);border-radius:10px;padding:10px 12px}
.btn.primary{background:#1f1f1f;border-color:#444}
.list a{display:block;padding:12px;border:1px solid var(--border);border-radius:12px;color:var(--fg);text-decoration:none;background:#0f0f0f}
.list a+a{margin-top:8px}
.choice{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid var(--border);border-radius:12px;margin-top:8px;cursor:pointer;background:#0f0f0f}
.choice.correct{border-color:var(--good)}.choice.wrong{border-color:var(--bad)}
.section{margin-top:12px}.muted{color:var(--muted)}.hidden{display:none}
.fig img{max-width:100%;border:1px solid var(--border);border-radius:8px;margin-top:8px;cursor:zoom-in}
.topnav{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap}
.badge{display:inline-block;border:1px solid var(--border);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
hr{border:0;border-top:1px solid var(--border);margin:16px 0}
</style></head>
<body><div class="wrap">
  <h1>노원구 꿈드림 검정고시 문제 풀이</h1>
  <div class="tabs">
    <button id="tabOne" class="tabbtn active">한 문제씩 풀기</button>
    <button id="tabExam" class="tabbtn">시험으로 풀기</button>
  </div>

  <section class="card" id="screenSelect">
    <div class="row">
      <label>항목<select id="selType"><option value="">전체</option><option>기출</option><option>모의고사</option></select></label>
      <label>난이도<select id="selLevel"><option value="">전체</option><option>고졸</option><option>중졸</option><option>초졸</option></select></label>
      <label>연도<select id="selYear"><option value="">전체</option><option>2025</option></select></label>
      <label>과목<select id="selSubject"><option value="">전체</option><option>수학</option></select></label>
      <button class="btn primary" id="btnSearch">검색</button>
    </div>
    <hr/>
    <div class="muted" id="searchInfo">검색 전입니다.</div>
    <div class="list" id="resultList"></div>
  </section>

  <section class="card hidden" id="screenOne">
    <div class="topnav">
      <div>
        <strong id="metaOne"></strong>
        <div class="muted" id="idxOne"></div>
      </div>
      <div class="row">
        <span class="badge">한 문제씩</span>
        <button class="btn" id="homeFromOne">홈으로</button>
      </div>
    </div>
    <div id="stemOne" style="white-space:pre-wrap;margin-top:12px"></div>
    <div id="figsOne" class="section fig"></div>
    <div id="choicesOne"></div>
    <div class="section">
      <div class="row">
        <button class="btn" id="prevOne">◀ 이전 문제</button>
        <button class="btn" id="nextOne">다음 문제 ▶</button>
      </div>
    </div>
    <div class="section muted" id="judgeOne"></div>
    <div class="section" id="explainOne" style="white-space:pre-wrap"></div>
  </section>

  <section class="card hidden" id="screenExam">
    <div class="topnav">
      <div>
        <strong id="metaExam"></strong>
        <div class="muted" id="idxExam">전체 문항이 한 번에 표시됩니다.</div>
      </div>
      <div class="row">
        <span class="badge">시험으로</span>
        <button class="btn" id="homeFromExam">홈으로</button>
        <button class="btn" id="gradeTop">채점하기</button>
      </div>
    </div>
    <div id="examList" class="section"></div>
    <div class="section" style="display:flex;justify-content:flex-end"><button class="btn" id="gradeBottom">채점하기</button></div>
    <div class="section hidden" id="examResult"></div>
  </section>
</div>

<script>
let MODE='one';
const tabOne=document.getElementById('tabOne'), tabExam=document.getElementById('tabExam');
function setActive(el){[tabOne,tabExam].forEach(b=>b.classList.remove('active'));el.classList.add('active');}
function goHome(){ screenSelect.classList.remove('hidden'); screenOne.classList.add('hidden'); screenExam.classList.add('hidden'); }
tabOne.onclick=()=>{ MODE='one'; setActive(tabOne); goHome(); };
tabExam.onclick=()=>{ MODE='exam'; setActive(tabExam); goHome(); };

const screenSelect=document.getElementById('screenSelect'), screenOne=document.getElementById('screenOne'), screenExam=document.getElementById('screenExam');
const btnSearch=document.getElementById('btnSearch'), resultList=document.getElementById('resultList'), searchInfo=document.getElementById('searchInfo');
const selType=document.getElementById('selType'), selLevel=document.getElementById('selLevel'), selYear=document.getElementById('selYear'), selSubject=document.getElementById('selSubject');

const metaOne=document.getElementById('metaOne'), idxOne=document.getElementById('idxOne'), stemOne=document.getElementById('stemOne'), figsOne=document.getElementById('figsOne'), choicesOne=document.getElementById('choicesOne');
const prevOne=document.getElementById('prevOne'), nextOne=document.getElementById('nextOne'), judgeOne=document.getElementById('judgeOne'), explainOne=document.getElementById('explainOne');

const metaExam=document.getElementById('metaExam'), examList=document.getElementById('examList'), examResult=document.getElementById('examResult');
const gradeTop=document.getElementById('gradeTop'), gradeBottom=document.getElementById('gradeBottom');
const homeFromOne=document.getElementById('homeFromOne'), homeFromExam=document.getElementById('homeFromExam');
homeFromOne.onclick=goHome; homeFromExam.onclick=goHome;

let MANIFEST=null, CURRENT=null, curIdx=0, userAnswers=[];

fetch('manifest.json').then(r=>r.json()).then(m=>{ MANIFEST=m; });

btnSearch.onclick=()=>{
  if(!MANIFEST){ alert('로딩 중입니다.'); return; }
  const type    = (selType.value||'').trim();
  const level   = (selLevel.value||'').trim();
  const year    = (selYear.value||'').trim();
  const subject = (selSubject.value||'').trim();

  const filtered = MANIFEST.sets.filter(s =>
    (!type    || s.type    === type) &&
    (!level   || s.level   === level) &&
    (!year    || String(s.year) === String(year)) &&
    (!subject || s.subject === subject)
  );

  searchInfo.textContent=`총 ${filtered.length}개 세트`;
  resultList.innerHTML='';
  if(!filtered.length){
    const p=document.createElement('p'); p.className='muted'; p.textContent='조건에 맞는 세트가 없습니다.'; resultList.appendChild(p); return;
  }
  filtered.forEach(s=>{
    const a=document.createElement('a'); a.href='#';
    a.textContent=`[${s.type}] ${s.year} ${s.level} ${s.subject}${s.round?' '+s.round:''}`;
    a.onclick=(e)=>{ e.preventDefault(); openSet(s); };
    resultList.appendChild(a);
  });
};

function openSet(s){
  fetch(s.path).then(r=>r.json()).then(js=>{
    CURRENT=js;
    if(MODE==='one'){ openOne(); } else { openExam(); }
  });
}

function renderFigures(container, q){
  container.innerHTML='';
  if(!q.figures) return;
  q.figures.forEach(fig=>{
    if(!fig.src) return;
    const img=document.createElement('img');
    img.src=fig.src; img.alt=fig.alt||fig.caption||'문항 그림'; img.style.maxWidth='100%';
    img.onclick=()=>window.open(fig.src, '_blank');
    container.appendChild(img);
    if(fig.caption){ const cap=document.createElement('div'); cap.className='muted'; cap.textContent=fig.caption; container.appendChild(cap); }
  });
}

// 한 문제씩: 선택 즉시 정답/해설
function openOne(){
  screenSelect.classList.add('hidden'); screenExam.classList.add('hidden'); screenOne.classList.remove('hidden');
  curIdx=0; userAnswers=new Array(CURRENT.questions.length).fill(null);
  renderOne();
}
function renderOne(){
  const q=CURRENT.questions[curIdx];
  metaOne.textContent=`${CURRENT.meta.year} ${CURRENT.meta.level} ${CURRENT.meta.subject}`;
  idxOne.textContent=`문항 ${q.number} / 총 ${CURRENT.questions.length}`;
  stemOne.textContent=q.stem;
  renderFigures(figsOne, q);
  choicesOne.innerHTML=''; judgeOne.textContent=''; explainOne.textContent='';
  q.choices.forEach((c,i)=>{
    const div=document.createElement('div'); div.className='choice';
    div.innerHTML=`<div class="btn" style="width:34px;text-align:center">${i+1}</div><div style="flex:1">${c}</div>`;
    div.onclick=()=>{
      userAnswers[curIdx]=i;
      const ok=(i===q.answerIndex);
      judgeOne.textContent= ok ? '정답입니다.' : `오답입니다. 정답은 ${q.answerIndex+1}번.`;
      judgeOne.style.color= ok ? 'var(--good)' : 'var(--bad)';
      explainOne.textContent = q.explanation || '';
      [...choicesOne.children].forEach(el=>{ el.classList.remove('correct','wrong'); el.style.outline=''; });
      div.classList.add(ok?'correct':'wrong');
      div.style.outline='2px solid #333';
    };
    choicesOne.appendChild(div);
  });
  prevOne.disabled=(curIdx===0); nextOne.disabled=(curIdx===CURRENT.questions.length-1);
}
prevOne.onclick=()=>{ if(curIdx>0){ curIdx--; renderOne(); } };
nextOne.onclick=()=>{ if(curIdx<CURRENT.questions.length-1){ curIdx++; renderOne(); } };

// 시험으로: 전 문항 표시, 채점 시 틀린 문항 해설 즉시
function openExam(){
  screenSelect.classList.add('hidden'); screenOne.classList.add('hidden'); screenExam.classList.remove('hidden');
  userAnswers = new Array(CURRENT.questions.length).fill(null);
  metaExam.textContent=`${CURRENT.meta.year} ${CURRENT.meta.level} ${CURRENT.meta.subject}`;
  examList.innerHTML=''; examResult.classList.add('hidden'); examResult.innerHTML='';

  CURRENT.questions.forEach((q,qi)=>{
    const wrap=document.createElement('div'); wrap.className='section'; wrap.id=`q${q.number}`;
    wrap.innerHTML = `<div><strong>문항 ${q.number}</strong></div><div style="white-space:pre-wrap;margin-top:6px">${q.stem}</div><div class='section fig' id='figs_ex_${q.number}'></div>`;
    // 래퍼 내부에서 그림 컨테이너 찾기 → DOM 타이밍 안전
    const figc = wrap.querySelector('#figs_ex_'+q.number);
    if(q.figures){
      q.figures.forEach(fig=>{
        if(!fig.src) return;
        const img=document.createElement('img'); img.src=fig.src; img.style.maxWidth='100%'; img.onclick=()=>window.open(fig.src,'_blank');
        figc.appendChild(img);
        if(fig.caption){ const cap=document.createElement('div'); cap.className='muted'; cap.textContent=fig.caption; figc.appendChild(cap); }
      });
    }
    const box=document.createElement('div'); box.style.marginTop='6px';
    q.choices.forEach((c,i)=>{
      const div=document.createElement('div'); div.className='choice';
      div.innerHTML=`<div class="btn" style="width:34px;text-align:center">${i+1}</div><div style="flex:1">${c}</div>`;
      div.onclick=()=>{ userAnswers[qi]=i; [...box.children].forEach(el=>el.style.outline=''); div.style.outline='2px solid #333'; };
      box.appendChild(div);
    });
    const exp=document.createElement('div'); exp.className='explain muted hidden'; exp.id=`exp${q.number}`;
    wrap.appendChild(box); wrap.appendChild(exp); examList.appendChild(wrap);
  });
}

function gradeExam(){
  let correct=0, wrongNums=[];
  CURRENT.questions.forEach((q,i)=>{ if(userAnswers[i]===q.answerIndex) correct++; else wrongNums.push(q.number); });
  const total=CURRENT.questions.length, score=Math.round((correct/total)*100);

  examResult.classList.remove('hidden');
  examResult.innerHTML=`<hr/><div><strong>점수: ${score}점</strong> (정답 ${correct}/${total})</div>`;

  // 모든 문항: 정답/오답 하이라이트 + 틀린 문항 해설 즉시 노출
  CURRENT.questions.forEach((q,i)=>{
    const wrap=document.getElementById('q'+q.number);
    if(!wrap) return;
    const choices=wrap.querySelectorAll('.choice');
    choices.forEach((el,idx)=>{
      el.classList.remove('correct','wrong'); el.style.outline='';
      if(idx===q.answerIndex) el.classList.add('correct');                 // 정답 → 초록 테두리
      if(userAnswers[i]===idx && idx!==q.answerIndex){                     // 내가 고른 오답 → 빨강 테두리
        el.classList.add('wrong'); el.style.outline='2px solid var(--bad)';
      }
    });
    const exp=document.getElementById('exp'+q.number);
    if(exp){
      const isWrong = userAnswers[i] !== q.answerIndex;
      if(isWrong){ exp.classList.remove('hidden'); exp.textContent=`정답: ${q.answerIndex+1}번\n해설: ${q.explanation||''}`; }
      else { exp.classList.add('hidden'); exp.textContent = q.explanation ? `해설: ${q.explanation}` : ''; }
    }
  });

  // 틀린 번호 점프 버튼
  if(wrongNums.length){
    const div=document.createElement('div'); div.style.marginTop='8px'; div.innerHTML='틀린 문항: ';
    wrongNums.forEach(n=>{ const btn=document.createElement('button'); btn.className='btn'; btn.textContent=String(n); btn.onclick=()=>{ document.getElementById('q'+n).scrollIntoView({behavior:'smooth',block:'start'}); }; div.appendChild(btn); });
    examResult.appendChild(div);
  }else{
    examResult.innerHTML += `<div class="muted">틀린 문제가 없습니다. 훌륭해요!</div>`;
  }
}

gradeTop.onclick=gradeExam; gradeBottom.onclick=gradeExam;
</script></body></html>
